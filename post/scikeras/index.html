<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Training Image Classification Models with scikeras - Saikat Kumar Dey</title><meta name=description content="In this blog post, we will demonstrate how to use the **scikeras** library to combine the capabilities of **TensorFlow** and **scikit-learn** for training image classification models. We will show how to use TensorFlow's `ImageDataGenerator()` function to load and augment images, and how to use scikeras's `KerasClassifier()` to create a scikit-learn compatible interface for training the model."><meta name=author content="Saikat Kumar Dey"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Saikat Kumar Dey","url":"https:\/\/saikatkumardey.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/saikatkumardey.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/saikatkumardey.com","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/saikatkumardey.com\/post\/scikeras\/","name":"Training image classification models with scikeras"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Saikat Kumar Dey"},"headline":"Training Image Classification Models with scikeras","description":"In this blog post, we will demonstrate how to use the **scikeras** library to combine the capabilities of **TensorFlow** and **scikit-learn** for training image classification models. We will show how to use TensorFlow\u0027s \u0060ImageDataGenerator()\u0060 function to load and augment images, and how to use scikeras\u0027s \u0060KerasClassifier()\u0060 to create a scikit-learn compatible interface for training the model.","inLanguage":"en","wordCount":968,"datePublished":"2022-06-25T13:06:10","dateModified":"2022-06-25T13:06:10","image":"https:\/\/saikatkumardey.com","keywords":[""],"mainEntityOfPage":"https:\/\/saikatkumardey.com\/post\/scikeras\/","publisher":{"@type":"Organization","name":"https:\/\/saikatkumardey.com","logo":{"@type":"ImageObject","url":"https:\/\/saikatkumardey.com","height":60,"width":60}}}</script><meta property="og:url" content="https://saikatkumardey.com/post/scikeras/"><meta property="og:type" content="website"><meta property="og:site_name" content="Saikat Kumar Dey"><link rel=apple-touch-icon sizes=180x180 href=https://saikatkumardey.com/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://saikatkumardey.com/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://saikatkumardey.com/favicon/favicon-16x16.png><meta name=generator content="Hugo 0.115.4"><link rel=alternate href=https://saikatkumardey.com/index.xml type=application/rss+xml title="Saikat Kumar Dey"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link rel=stylesheet href=https://saikatkumardey.com/css/main.css><link disabled id=dark-mode-theme rel=stylesheet href=https://saikatkumardey.com/css/dark.css><link rel=stylesheet href=https://saikatkumardey.com/css/highlight.min.css><link rel=stylesheet href=https://saikatkumardey.com/css/codeblock.css></head><body><div class="container fixed-top"><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-10 col-xl-10"><nav class="navbar navbar-expand-lg navbar-light fixed-top p-0"><div class=container><a class="navbar-brand fw-bold" href=https://saikatkumardey.com>Saikat Kumar Dey</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=navbarNav><ul class="navbar-nav mb-2 mb-lg-0"><li class=nav-item><a class=nav-link title=Home href=/>Home</a></li><li class=nav-item><a class=nav-link title=Projects href=/projects/>Projects</a></li><li class=nav-item><a class=nav-link title=Now href=/now/>Now</a></li><li class="nav-item nav-link"><a id=dark-mode-toggle class="bi bi-sun"></a></li></ul></div></div></nav></div></div></div><header class=header-section><div class="intro-header no-img mt-10"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-8 col-xl-8"><div class="col-sm-12 col-md-12 col-lg-12 col-xl-12"><div class=post-heading><h1 class="fw-semibold display-5 lh-1 mb-3">Training Image Classification Models with scikeras</h1><span class=post-meta>&nbsp;June 25, 2022</span></div></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1"><div class="card-image card-image-blog p-0"></div></div><div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4"><article role=main class=blog-post><h2 id=introduction-to-scikeras>Introduction to scikeras</h2><p>Scikeras is a powerful tool that allows users to combine the capabilities of TensorFlow and scikit-learn in order to train deep learning models. By using scikeras, users can take advantage of the strengths of both TensorFlow and scikit-learn, and benefit from the ease of use and flexibility of scikit-learn&rsquo;s API.</p><p>In this blog post, we will demonstrate how to use scikeras to train a model using a large dataset of images stored on disk. We will show how to use TensorFlow&rsquo;s <code>ImageDataGenerator()</code> function to load images in batches and apply real-time augmentation, and how to use scikeras&rsquo;s <code>KerasClassifier()</code> to create a scikit-learn compatible interface for training the model. We will also demonstrate how to use <code>partial_fit()</code> to train the model on smaller batches of data and retain the history of model weights and parameters.</p><h2 id=download-dataset>Download dataset</h2><p>Download a sample <a href=https://www.kaggle.com/datasets/muratkokludataset/pistachio-image-dataset>dataset</a> and store the dataset in <code>data/</code>. Your directory structure should look like the following:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>data/Pistachio_Image_Dataset
</span></span><span style=display:flex><span>├── Kirmizi_Pistachio/*.jpg
</span></span><span style=display:flex><span>└── Siirt_Pistachio/*.jpg
</span></span></code></pre></div><h2 id=import-necessary-libraries>Import necessary libraries</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>from</span> <span style=color:#555>math</span> <span style=font-weight:700>import</span> ceil
</span></span><span style=display:flex><span><span style=font-weight:700>import</span> <span style=color:#555>tensorflow</span> <span style=font-weight:700>as</span> <span style=color:#555>tf</span>
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=color:#555>matplotlib</span> <span style=font-weight:700>import</span> pyplot <span style=font-weight:700>as</span> plt
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=color:#555>scikeras.wrappers</span> <span style=font-weight:700>import</span> KerasClassifier
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=color:#555>tensorflow.keras.preprocessing.image</span> <span style=font-weight:700>import</span> ImageDataGenerator
</span></span></code></pre></div><h2 id=setup-constants>Setup Constants</h2><p>Next, we need to set some constants that will be used throughout the training process. In this example, we will be using a batch size of 32 and training the model for 10 epochs. You may need to adjust these values depending on your dataset and the performance of your model.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>DATA_DIR <span style=font-weight:700>=</span> <span style=color:#b84>&#34;data/Pistachio_Image_Dataset&#34;</span>
</span></span><span style=display:flex><span>BATCH_SIZE <span style=font-weight:700>=</span> <span style=color:#099>32</span>
</span></span><span style=display:flex><span>EPOCHS <span style=font-weight:700>=</span> <span style=color:#099>10</span>
</span></span></code></pre></div><h2 id=loader-for-reading-data-in-batches>Loader for reading data in batches</h2><p>One of the key advantages of using scikeras is the ability to train a model using large datasets that do not fit into memory. To do this, we can use TensorFlow&rsquo;s <code>ImageDataGenerator()</code> function to load images in batches and apply real-time augmentation. This allows us to train the model on smaller chunks of the dataset, without having to load the entire dataset into memory.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>image_generator <span style=font-weight:700>=</span> ImageDataGenerator(rescale<span style=font-weight:700>=</span><span style=color:#099>1.0</span> <span style=font-weight:700>/</span> <span style=color:#099>255</span>)<span style=font-weight:700>.</span>flow_from_directory(
</span></span><span style=display:flex><span>    DATA_DIR,
</span></span><span style=display:flex><span>    target_size<span style=font-weight:700>=</span>(<span style=color:#099>32</span>, <span style=color:#099>32</span>),
</span></span><span style=display:flex><span>    batch_size<span style=font-weight:700>=</span>BATCH_SIZE,
</span></span><span style=display:flex><span>    class_mode<span style=font-weight:700>=</span><span style=color:#b84>&#34;binary&#34;</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>total_images <span style=font-weight:700>=</span> <span style=color:#999>len</span>(image_generator<span style=font-weight:700>.</span>filenames)
</span></span><span style=display:flex><span>total_batches <span style=font-weight:700>=</span> ceil(total_images <span style=font-weight:700>//</span> BATCH_SIZE)
</span></span></code></pre></div><p>In this code, we are using ImageDataGenerator() to create a generator that will load the images in DATA_DIR in batches of size BATCH_SIZE, apply a rescaling factor of 1/255, and return the images and labels in a binary format. We then calculate the total number of images in the dataset and the total number of batches. These values will be used later in the training loop.</p><h2 id=define-your-tensorflow-model-architecture>Define your Tensorflow model architecture</h2><p>Next, we need to define the architecture of our TensorFlow model. For the purposes of this example, we will be using a simple shallow-net with a single dense layer. However, you can use any architecture that you prefer, and you can experiment with different architectures to see which one performs best on your dataset.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>model <span style=font-weight:700>=</span> tf<span style=font-weight:700>.</span>keras<span style=font-weight:700>.</span>Sequential(
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>        tf<span style=font-weight:700>.</span>keras<span style=font-weight:700>.</span>layers<span style=font-weight:700>.</span>Input(shape<span style=font-weight:700>=</span>(<span style=color:#099>32</span>, <span style=color:#099>32</span>, <span style=color:#099>3</span>)),
</span></span><span style=display:flex><span>        tf<span style=font-weight:700>.</span>keras<span style=font-weight:700>.</span>layers<span style=font-weight:700>.</span>Flatten(),
</span></span><span style=display:flex><span>        tf<span style=font-weight:700>.</span>keras<span style=font-weight:700>.</span>layers<span style=font-weight:700>.</span>Dense(<span style=color:#099>1</span>, activation<span style=font-weight:700>=</span><span style=color:#b84>&#34;sigmoid&#34;</span>),
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h2 id=define-scikeras-interface>Define scikeras interface</h2><p>Once we have defined our TensorFlow model, we can use scikeras&rsquo;s KerasClassifier() function to create a scikit-learn compatible interface for training the model. This allows us to use the familiar fit() and predict() methods from scikit-learn, while taking advantage of the capabilities of TensorFlow.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sk_clf <span style=font-weight:700>=</span> KerasClassifier(
</span></span><span style=display:flex><span>    model<span style=font-weight:700>=</span>model,
</span></span><span style=display:flex><span>    optimizer<span style=font-weight:700>=</span><span style=color:#b84>&#34;adam&#34;</span>,
</span></span><span style=display:flex><span>    loss<span style=font-weight:700>=</span><span style=color:#b84>&#34;binary_crossentropy&#34;</span>,
</span></span><span style=display:flex><span>    metrics<span style=font-weight:700>=</span>[<span style=color:#b84>&#34;accuracy&#34;</span>],
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>In this code, we are creating a KerasClassifier object and passing it our TensorFlow model, as well as some other parameters such as the optimizer and loss function to use during training. We are also specifying that we want to track the accuracy metric during training. You can adjust these parameters as needed to suit your specific use.</p><h2 id=training-loop>Training loop</h2><p>Now that we have set up the necessary components for training our model, we can implement the main training loop. This loop will iterate over the batches of images generated by <code>ImageDataGenerator()</code>, and will use <code>partial_fit()</code> to train the model on each batch. <code>partial_fit()</code> has the advantage of allowing us to train the model on smaller batches of data, and it also retains the history of model weights and parameters, whereas <code>fit()</code> resets this history every time it is called.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>batch <span style=font-weight:700>=</span> <span style=color:#099>0</span>
</span></span><span style=display:flex><span>epoch <span style=font-weight:700>=</span> <span style=color:#099>0</span>
</span></span><span style=display:flex><span>histories <span style=font-weight:700>=</span> []
</span></span><span style=display:flex><span><span style=font-weight:700>for</span> X, y <span style=font-weight:700>in</span> image_generator:
</span></span><span style=display:flex><span>    sk_clf<span style=font-weight:700>.</span>partial_fit(X, y, verbose<span style=font-weight:700>=</span><span style=font-weight:700>False</span>)
</span></span><span style=display:flex><span>    history <span style=font-weight:700>=</span> sk_clf<span style=font-weight:700>.</span>model_<span style=font-weight:700>.</span>history<span style=font-weight:700>.</span>history
</span></span><span style=display:flex><span>    histories<span style=font-weight:700>.</span>append(history)
</span></span><span style=display:flex><span>    batch <span style=font-weight:700>+=</span> <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> batch <span style=font-weight:700>==</span> total_batches:
</span></span><span style=display:flex><span>        batch <span style=font-weight:700>=</span> <span style=color:#099>0</span>
</span></span><span style=display:flex><span>        epoch <span style=font-weight:700>+=</span> <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        <span style=color:#999>print</span>(
</span></span><span style=display:flex><span>            <span style=color:#b84>f</span><span style=color:#b84>&#34;epoch </span><span style=color:#b84>{</span>epoch<span style=color:#b84>}</span><span style=color:#b84>/</span><span style=color:#b84>{</span>EPOCHS<span style=color:#b84>}</span><span style=color:#b84>, loss </span><span style=color:#b84>{</span>history[<span style=color:#b84>&#39;loss&#39;</span>][<span style=color:#099>0</span>]<span style=color:#b84>}</span><span style=color:#b84> accuracy </span><span style=color:#b84>{</span>history[<span style=color:#b84>&#39;accuracy&#39;</span>][<span style=color:#099>0</span>]<span style=color:#b84>}</span><span style=color:#b84>&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> epoch <span style=font-weight:700>==</span> EPOCHS:
</span></span><span style=display:flex><span>        <span style=font-weight:700>break</span>
</span></span></code></pre></div><p>In this code, we are looping over the batches generated by ImageDataGenerator() and calling partial_fit() on each batch. We are also keeping track of the history of model weights and parameters, and we are printing the loss and accuracy for each epoch. Once we have reached the specified number of epochs, the training loop will exit and the model will be trained. At this point, you can use the <code>predict()</code> method to make predictions on new data, or you can continue training the model using <code>partial_fit()</code> to improve its performance further.</p><h2 id=conclusion>Conclusion</h2><p>In this blog post, we have demonstrated how to use scikeras to train a TensorFlow model on a large dataset of images stored on disk. We have shown how to use <code>ImageDataGenerator()</code> to load images in batches and apply real-time augmentation, how to use <code>KerasClassifier()</code> to create a scikit-learn compatible interface for training the model, and how to use <code>partial_fit()</code> to train the model on smaller batches of data and retain the history of model weights and parameters.</p><p>Overall, scikeras is a convenient and effective tool for training image classification models, and it allows users to take advantage of the strengths of both TensorFlow and scikit-learn. There are many potential avenues for further improvement, such as experimenting with different model architectures, fine-tuning the training parameters, and applying more advanced augmentation techniques. We hope that this blog post has provided a useful introduction to scikeras and has given you some ideas for how to use it in your own projects.</p></article></div></div><div class=row><div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1"><hr></div><div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-2"></div><div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4"><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><div><p class="list-inline footer-links">Use the share button below if you liked it.</p></div><ul class=share><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsaikatkumardey.com%2fpost%2fscikeras%2f" target=_blank title="Share on Facebook"><i class="bi bi-facebook facebook-color"></i></a></li><li><a href="//twitter.com/share?url=https%3a%2f%2fsaikatkumardey.com%2fpost%2fscikeras%2f&amp;text=Training%20Image%20Classification%20Models%20with%20scikeras&amp;via=map%5bemail%3asample%40gmail.com%20facebook%3ausername%20github%3asaikatkumardey%20linkedin%3asaikatkumardey%20name%3aSaikat%20Kumar%20Dey%20twitter%3asaikatkrdey%20website%3ahttps%3a%2f%2fsaikatkumardey.com%2f%20youtube%3a%5d" target=_blank title="Share on Twitter"><i class="bi bi-twitter twitter-color"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fsaikatkumardey.com%2fpost%2fscikeras%2f&amp;title=Training%20Image%20Classification%20Models%20with%20scikeras" target=_blank title="Share on Reddit"><i class="bi bi-reddit reddit-color"></i></a></li><li><a href="whatsapp://send?text=https%3a%2f%2fsaikatkumardey.com%2fpost%2fscikeras%2f&amp;description=Training%20Image%20Classification%20Models%20with%20scikeras" target=_blank rel=noopener title="Share on WhatsApp"><i class="bi bi-whatsapp whatsapp-color"></i></a></li></ul></div></div></section></div><div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4"><ul class="list-group list-group-horizontal" style=flex-direction:row><li class="list-group-item b-0"><a type=button class="btn btn-dark" role=button href=https://saikatkumardey.com/post/14-walk/ data-toggle=tooltip data-placement=top title="Walking helps you solve difficult bugs">&larr;
Previous Post</a></li><li class="list-group-item ms-auto b-0"><a type=button class="btn btn-dark" role=button href=https://saikatkumardey.com/post/15/ data-toggle=tooltip data-placement=top title="How to love what you do?">Next Post
&rarr;</a></li></ul></div><div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4"></div></div></div><div><div class=container><div class=row></div></div></div></div></div><footer><div class=container><div class=row><div class=col-md-12><ul class="list-inline list-group list-group-horizontal text-center footer-links d-flex justify-content-center flex-row"><li><a href=mailto:sample@gmail.com title="Email me" target=_blank><span class=mx-2><i class="bi bi-envelope"></i></span></a></li><li><a href=https://www.facebook.com/username title=Facebook target=_blank><span class=mx-2><i class="bi bi-facebook"></i></span></a></li><li><a href=https://github.com/saikatkumardey title=GitHub target=_blank><span class=mx-2><i class="bi bi-github"></i></span></a></li><li><a href=https://twitter.com/saikatkrdey title=Twitter target=_blank><span class=mx-2><i class="bi bi-twitter"></i></span></a></li><li><a href=https://linkedin.com/in/saikatkumardey title=LinkedIn target=_blank><span class=mx-2><i class="bi bi-linkedin"></i></span></a></li><li><a href=https://www.youtube.com/ title=Youtube target=_blank><span class=mx-2><i class="bi bi-youtube"></i></span></a></li></ul></div></div><div class=row><div class=col-md-12><p class="credits copyright text-muted"><a href=https://saikatkumardey.com/>Saikat Kumar Dey</a>
&nbsp;&bull;&nbsp;&copy;
2023
&nbsp;&bull;&nbsp;
<a href=https://saikatkumardey.com>Saikat Kumar Dey</a></p><p class="credits theme-by text-muted">Powered by <a href=https://gohugo.io>Hugo</a> & <a href=https://github.com/binokochumolvarghese/lightbi-hugo>Lightbi.</a>&nbsp; Made with ❤ by <a href=https://binovarghese.com>Bino</a></p></div></div></div></footer><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js integrity=sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ crossorigin=anonymous></script>
<script src=https://saikatkumardey.com/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script src=https://saikatkumardey.com/js/dark-mode.js></script></body></html>