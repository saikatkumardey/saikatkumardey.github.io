<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head><title>Training Image Classification Models with scikeras |
Saikat Kumar Dey</title><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Saikat Kumar Dey"><meta name=description content="Machine Learning Engineer"><link rel=stylesheet href=/scss/main.min.1147aa5bacb4bce677a0e264073829caedb82fd18ea07a5f1d80521f539d1c45.css integrity="sha256-EUeqW6y0vOZ3oOJkBzgpyu24L9GOoHpfHYBSH1OdHEU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=https://saikatkumardey.com/post/scikeras/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://saikatkumardey.com/images/site-feature-image.png"><meta name=twitter:title content="Training Image Classification Models with scikeras"><meta name=twitter:description content="In this blog post, we will demonstrate how to use the scikeras library to combine the capabilities of TensorFlow and scikit-learn for training image classification models. We will show how to use TensorFlow&rsquo;s ImageDataGenerator() function to load and augment images, and how to use scikeras&rsquo;s KerasClassifier() to create a scikit-learn compatible interface for training the model."><meta property="og:title" content="Training Image Classification Models with scikeras"><meta property="og:description" content="In this blog post, we will demonstrate how to use the scikeras library to combine the capabilities of TensorFlow and scikit-learn for training image classification models. We will show how to use TensorFlow&rsquo;s ImageDataGenerator() function to load and augment images, and how to use scikeras&rsquo;s KerasClassifier() to create a scikit-learn compatible interface for training the model."><meta property="og:type" content="article"><meta property="og:url" content="https://saikatkumardey.com/post/scikeras/"><meta property="og:image" content="https://saikatkumardey.com/images/site-feature-image.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-06-25T13:06:10+05:30"><meta property="article:modified_time" content="2022-06-25T13:06:10+05:30"><meta property="og:site_name" content="Saikat Kumar Dey"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"Training Image Classification Models with scikeras","headline":"Training Image Classification Models with scikeras","alternativeHeadline":"","description":"
      
        In this blog post, we will demonstrate how to use the \u003cstrong\u003escikeras\u003c\/strong\u003e library to combine the capabilities of \u003cstrong\u003eTensorFlow\u003c\/strong\u003e and \u003cstrong\u003escikit-learn\u003c\/strong\u003e for training image classification models. We will show how to use TensorFlow\u0026rsquo;s \u003ccode\u003eImageDataGenerator()\u003c\/code\u003e function to load and augment images, and how to use scikeras\u0026rsquo;s \u003ccode\u003eKerasClassifier()\u003c\/code\u003e to create a scikit-learn compatible interface for training the model.


      


    ","inLanguage":"en","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/saikatkumardey.com\/post\/scikeras\/"},"author":{"@type":"Person","name":"Saikat Kumar Dey"},"creator":{"@type":"Person","name":"Saikat Kumar Dey"},"accountablePerson":{"@type":"Person","name":"Saikat Kumar Dey"},"copyrightHolder":{"@type":"Person","name":"Saikat Kumar Dey"},"copyrightYear":"2022","dateCreated":"2022-06-25T13:06:10.00Z","datePublished":"2022-06-25T13:06:10.00Z","dateModified":"2022-06-25T13:06:10.00Z","publisher":{"@type":"Organization","name":"Saikat Kumar Dey","url":"https://saikatkumardey.com","logo":{"@type":"ImageObject","url":"https:\/\/saikatkumardey.com\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":["https://saikatkumardey.com/images/site-feature-image.png"],"url":"https:\/\/saikatkumardey.com\/post\/scikeras\/","wordCount":"968","genre":["ml","computer-vision","tensorflow","scikeras"],"keywords":[]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/dp.jpg alt="profile picture"><div class=sidebar__introduction-title><a href=/>Saikat Kumar Dey</a></div><div class=sidebar__introduction-description><p>Machine Learning Engineer</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://linkedin.com/in/saikatkumardey target=_blank rel="noopener me" aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/saikatkumardey/ target=_blank rel="noopener me" aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.instagram.com/saikatkumardey/ target=_blank rel="noopener me" aria-label=instagram title=instagram><i class="fab fa-instagram fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/saikatkrdey target=_blank rel="noopener me" aria-label=twitter title=twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Saikat Kumar Dey
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Home</a></li><li class=nav__list-item><a href=/post/ title>Posts</a></li><li class=nav__list-item><a href=/projects/ title>Projects</a></li><li class=nav__list-item><a href=/now/ title>Now</a></li><li class=nav__list-item><a href=/contact/ title>Contact</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Training Image Classification Models With Scikeras</h1><ul class=post__meta><li class=post__meta-item><em class="fas fa-calendar-day post__meta-icon"></em>
<span class=post__meta-text>25/6/2022</span></li><li class=post__meta-item><em class="fas fa-stopwatch post__meta-icon"></em>
<span class=post__meta-text>5-minute read</span></li></ul><h2 id=introduction-to-scikeras>Introduction to scikeras</h2><p>Scikeras is a powerful tool that allows users to combine the capabilities of TensorFlow and scikit-learn in order to train deep learning models. By using scikeras, users can take advantage of the strengths of both TensorFlow and scikit-learn, and benefit from the ease of use and flexibility of scikit-learn&rsquo;s API.</p><p>In this blog post, we will demonstrate how to use scikeras to train a model using a large dataset of images stored on disk. We will show how to use TensorFlow&rsquo;s <code>ImageDataGenerator()</code> function to load images in batches and apply real-time augmentation, and how to use scikeras&rsquo;s <code>KerasClassifier()</code> to create a scikit-learn compatible interface for training the model. We will also demonstrate how to use <code>partial_fit()</code> to train the model on smaller batches of data and retain the history of model weights and parameters.</p><h2 id=download-dataset>Download dataset</h2><p>Download a sample <a href=https://www.kaggle.com/datasets/muratkokludataset/pistachio-image-dataset>dataset</a> and store the dataset in <code>data/</code>. Your directory structure should look like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>data/Pistachio_Image_Dataset
</span></span><span class=line><span class=cl>├── Kirmizi_Pistachio/*.jpg
</span></span><span class=line><span class=cl>└── Siirt_Pistachio/*.jpg
</span></span></code></pre></div><h2 id=import-necessary-libraries>Import necessary libraries</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>ceil</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>tensorflow</span> <span class=k>as</span> <span class=nn>tf</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>matplotlib</span> <span class=kn>import</span> <span class=n>pyplot</span> <span class=k>as</span> <span class=n>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scikeras.wrappers</span> <span class=kn>import</span> <span class=n>KerasClassifier</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tensorflow.keras.preprocessing.image</span> <span class=kn>import</span> <span class=n>ImageDataGenerator</span>
</span></span></code></pre></div><h2 id=setup-constants>Setup Constants</h2><p>Next, we need to set some constants that will be used throughout the training process. In this example, we will be using a batch size of 32 and training the model for 10 epochs. You may need to adjust these values depending on your dataset and the performance of your model.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>DATA_DIR</span> <span class=o>=</span> <span class=s2>&#34;data/Pistachio_Image_Dataset&#34;</span>
</span></span><span class=line><span class=cl><span class=n>BATCH_SIZE</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=n>EPOCHS</span> <span class=o>=</span> <span class=mi>10</span>
</span></span></code></pre></div><h2 id=loader-for-reading-data-in-batches>Loader for reading data in batches</h2><p>One of the key advantages of using scikeras is the ability to train a model using large datasets that do not fit into memory. To do this, we can use TensorFlow&rsquo;s <code>ImageDataGenerator()</code> function to load images in batches and apply real-time augmentation. This allows us to train the model on smaller chunks of the dataset, without having to load the entire dataset into memory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>image_generator</span> <span class=o>=</span> <span class=n>ImageDataGenerator</span><span class=p>(</span><span class=n>rescale</span><span class=o>=</span><span class=mf>1.0</span> <span class=o>/</span> <span class=mi>255</span><span class=p>)</span><span class=o>.</span><span class=n>flow_from_directory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>DATA_DIR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>target_size</span><span class=o>=</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_size</span><span class=o>=</span><span class=n>BATCH_SIZE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>class_mode</span><span class=o>=</span><span class=s2>&#34;binary&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>total_images</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>image_generator</span><span class=o>.</span><span class=n>filenames</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>total_batches</span> <span class=o>=</span> <span class=n>ceil</span><span class=p>(</span><span class=n>total_images</span> <span class=o>//</span> <span class=n>BATCH_SIZE</span><span class=p>)</span>
</span></span></code></pre></div><p>In this code, we are using ImageDataGenerator() to create a generator that will load the images in DATA_DIR in batches of size BATCH_SIZE, apply a rescaling factor of 1/255, and return the images and labels in a binary format. We then calculate the total number of images in the dataset and the total number of batches. These values will be used later in the training loop.</p><h2 id=define-your-tensorflow-model-architecture>Define your Tensorflow model architecture</h2><p>Next, we need to define the architecture of our TensorFlow model. For the purposes of this example, we will be using a simple shallow-net with a single dense layer. However, you can use any architecture that you prefer, and you can experiment with different architectures to see which one performs best on your dataset.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Input</span><span class=p>(</span><span class=n>shape</span><span class=o>=</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>3</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Flatten</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Dense</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=s2>&#34;sigmoid&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h2 id=define-scikeras-interface>Define scikeras interface</h2><p>Once we have defined our TensorFlow model, we can use scikeras&rsquo;s KerasClassifier() function to create a scikit-learn compatible interface for training the model. This allows us to use the familiar fit() and predict() methods from scikit-learn, while taking advantage of the capabilities of TensorFlow.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sk_clf</span> <span class=o>=</span> <span class=n>KerasClassifier</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>optimizer</span><span class=o>=</span><span class=s2>&#34;adam&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>loss</span><span class=o>=</span><span class=s2>&#34;binary_crossentropy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>metrics</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;accuracy&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>In this code, we are creating a KerasClassifier object and passing it our TensorFlow model, as well as some other parameters such as the optimizer and loss function to use during training. We are also specifying that we want to track the accuracy metric during training. You can adjust these parameters as needed to suit your specific use.</p><h2 id=training-loop>Training loop</h2><p>Now that we have set up the necessary components for training our model, we can implement the main training loop. This loop will iterate over the batches of images generated by <code>ImageDataGenerator()</code>, and will use <code>partial_fit()</code> to train the model on each batch. <code>partial_fit()</code> has the advantage of allowing us to train the model on smaller batches of data, and it also retains the history of model weights and parameters, whereas <code>fit()</code> resets this history every time it is called.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>batch</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>epoch</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>histories</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>X</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>image_generator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>sk_clf</span><span class=o>.</span><span class=n>partial_fit</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>history</span> <span class=o>=</span> <span class=n>sk_clf</span><span class=o>.</span><span class=n>model_</span><span class=o>.</span><span class=n>history</span><span class=o>.</span><span class=n>history</span>
</span></span><span class=line><span class=cl>    <span class=n>histories</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>history</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>batch</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>batch</span> <span class=o>==</span> <span class=n>total_batches</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>batch</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>epoch</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;epoch </span><span class=si>{</span><span class=n>epoch</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>EPOCHS</span><span class=si>}</span><span class=s2>, loss </span><span class=si>{</span><span class=n>history</span><span class=p>[</span><span class=s1>&#39;loss&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2> accuracy </span><span class=si>{</span><span class=n>history</span><span class=p>[</span><span class=s1>&#39;accuracy&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>epoch</span> <span class=o>==</span> <span class=n>EPOCHS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></div><p>In this code, we are looping over the batches generated by ImageDataGenerator() and calling partial_fit() on each batch. We are also keeping track of the history of model weights and parameters, and we are printing the loss and accuracy for each epoch. Once we have reached the specified number of epochs, the training loop will exit and the model will be trained. At this point, you can use the <code>predict()</code> method to make predictions on new data, or you can continue training the model using <code>partial_fit()</code> to improve its performance further.</p><h2 id=conclusion>Conclusion</h2><p>In this blog post, we have demonstrated how to use scikeras to train a TensorFlow model on a large dataset of images stored on disk. We have shown how to use <code>ImageDataGenerator()</code> to load images in batches and apply real-time augmentation, how to use <code>KerasClassifier()</code> to create a scikit-learn compatible interface for training the model, and how to use <code>partial_fit()</code> to train the model on smaller batches of data and retain the history of model weights and parameters.</p><p>Overall, scikeras is a convenient and effective tool for training image classification models, and it allows users to take advantage of the strengths of both TensorFlow and scikit-learn. There are many potential avenues for further improvement, such as experimenting with different model architectures, fine-tuning the training parameters, and applying more advanced augmentation techniques. We hope that this blog post has provided a useful introduction to scikeras and has given you some ideas for how to use it in your own projects.</p></div><div class=post__footer><span><a class=category href=/categories/ml/>ml</a><a class=category href=/categories/computer-vision/>computer-vision</a><a class=category href=/categories/tensorflow/>tensorflow</a><a class=category href=/categories/scikeras/>scikeras</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Saikat Kumar Dey
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>