<!doctype html><html><head><meta charset=utf-8><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to convert multi-dimensional numpy arrays to pandas dataframe?"><base href=https://saikatkumardey.com/><title>Building Pandas Dataframes From Ndarrays | Saikat Kumar Dey</title><link rel=canonical href=https://saikatkumardey.com/essays/building-pandas-dataframes-from-ndarrays/><link href=https://saikatkumardey.com/css/style.css type=text/css rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Alegreya&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Fira+Mono&display=swap" rel=stylesheet><script async defer data-domain=saikatkumardey.com src=https://plausible.io/js/plausible.outbound-links.js></script><meta property="og:title" content="Building Pandas Dataframes From Ndarrays"><meta property="og:description" content="How to convert multi-dimensional numpy arrays to pandas dataframe?"><meta property="og:type" content="article"><meta property="og:url" content="https://saikatkumardey.com/essays/building-pandas-dataframes-from-ndarrays/"><meta property="article:section" content="essays"><meta property="article:published_time" content="2021-09-28T10:06:23+05:30"><meta property="article:modified_time" content="2021-09-28T10:06:23+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building Pandas Dataframes From Ndarrays"><meta name=twitter:description content="How to convert multi-dimensional numpy arrays to pandas dataframe?"></head><body><div class=container><header><h1><a href=https://saikatkumardey.com/>Saikat Kumar Dey</a></h1><nav><ul><li><a href=https://saikatkumardey.com/essays/ title>Essays</a></li><li><a href=https://saikatkumardey.com/daily/ title>Daily</a></li></ul></nav></header><div id=content><main class=essay><h1 id=title>Building Pandas Dataframes From Ndarrays</h1><aside class=meta><div><span class=date>September 28, 2021 â€¢ ~700 words</span><ul class=categories><li><i>in</i></li><li><a href=https://saikatkumardey.com/categories/coding/>coding</a></li><li><a href=https://saikatkumardey.com/categories/python/>python</a></li></ul></div></aside><div><article id=content><p>At work, I have to switch between numpy & pandas depending on the computational needs. Numpy is faster. Pandas is easier to work with.</p><p>One of the tasks I&rsquo;ve faced often was to convert a 3-dimensional ndarray to a pandas dataframe. I will share my preferred technique in this post today.</p><p>For the purpose of this exercise, I&rsquo;ll generate dummy sales data for a retail company. The dimensions include products, locations, and sales.</p><h1 id=convert-ndarray-to-pandas-dataframe>Convert ndarray to pandas dataframe</h1><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#719e07>import</span> pandas <span style=color:#719e07>as</span> pd
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> numpy <span style=color:#719e07>as</span> np
</span></span></code></pre></div><h2 id=1d--dimension--sales>1d : dimension = sales</h2><p>Let&rsquo;s start with 1d data. What if we only had sales info for all products and locations?</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>arr_1d <span style=color:#719e07>=</span> np<span style=color:#719e07>.</span>random<span style=color:#719e07>.</span>randint(
</span></span><span style=display:flex><span>    low<span style=color:#719e07>=</span><span style=color:#2aa198>1</span>,
</span></span><span style=display:flex><span>    high<span style=color:#719e07>=</span><span style=color:#2aa198>10</span>,
</span></span><span style=display:flex><span>    size<span style=color:#719e07>=</span><span style=color:#2aa198>3</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(arr_1d)
</span></span></code></pre></div><pre><code>[9 3 6]
</code></pre><p>That&rsquo;s easy. Ideally, 1-d information should be represented as a Series.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df_1d <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>DataFrame(arr_1d, columns<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;sales&#34;</span>])
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(df_1d)
</span></span></code></pre></div><pre><code>   sales
0      9
1      3
2      6
</code></pre><h2 id=2d-dimension--sales--product>2d: dimension = sales * product</h2><p>Let&rsquo;s move on to 2 dimensions. Now, we have data corresponding to different products.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>arr_2d <span style=color:#719e07>=</span> np<span style=color:#719e07>.</span>random<span style=color:#719e07>.</span>randint(
</span></span><span style=display:flex><span>    low<span style=color:#719e07>=</span><span style=color:#2aa198>1</span>,
</span></span><span style=display:flex><span>    high<span style=color:#719e07>=</span><span style=color:#2aa198>10</span>,
</span></span><span style=display:flex><span>    size<span style=color:#719e07>=</span>(<span style=color:#2aa198>3</span>, <span style=color:#2aa198>2</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(arr_2d)
</span></span></code></pre></div><pre><code>[[4 6]
 [8 1]
 [2 7]]
</code></pre><p>Pandas DataFrame can handle 2-D ndarrays out of the box.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df_2d <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>DataFrame(arr_2d, columns<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;product&#34;</span>, <span style=color:#2aa198>&#34;sales&#34;</span>])<span style=color:#719e07>.</span>set_index(<span style=color:#2aa198>&#34;product&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(df_2d)
</span></span></code></pre></div><pre><code>         sales
product       
4            6
8            1
2            7
</code></pre><h2 id=3d--dimension--location-x-product-x-sales>3d : dimension = location x product x sales</h2><p>Now, what if we have a ndarray corresponding to all products for several locations?</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#586e75># failure</span>
</span></span><span style=display:flex><span>arr_3d <span style=color:#719e07>=</span> np<span style=color:#719e07>.</span>random<span style=color:#719e07>.</span>randint(
</span></span><span style=display:flex><span>    low<span style=color:#719e07>=</span><span style=color:#2aa198>1</span>,
</span></span><span style=display:flex><span>    high<span style=color:#719e07>=</span><span style=color:#2aa198>10</span>,
</span></span><span style=display:flex><span>    size<span style=color:#719e07>=</span>(<span style=color:#2aa198>5</span>, <span style=color:#2aa198>3</span>, <span style=color:#2aa198>1</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(arr_3d)
</span></span></code></pre></div><pre><code>[[[9]
  [6]
  [2]]

 [[1]
  [4]
  [4]]

 [[2]
  [5]
  [6]]

 [[9]
  [6]
  [5]]

 [[1]
  [6]
  [1]]]
</code></pre><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#586e75># the following raises ValueError</span>
</span></span><span style=display:flex><span><span style=color:#586e75># pandas DataFrame expects a 2-d input</span>
</span></span><span style=display:flex><span>df_3d <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>DataFrame(arr_3d, columns<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;location&#34;</span>, <span style=color:#2aa198>&#34;product&#34;</span>, <span style=color:#2aa198>&#34;sales&#34;</span>])
</span></span></code></pre></div><p>pandas won&rsquo;t work out of the box. It cannot handle more than 2 dimensions. So, it raises a <code>ValueError</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bas data-lang=bas><span style=display:flex><span>    <span style=color:#719e07>---------------------------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ValueError                                Traceback (most recent call last)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>/</span>var<span style=color:#719e07>/</span>folders<span style=color:#719e07>/</span>jq<span style=color:#719e07>/</span>ksxbjg7d58g9v9rrcl0f38380000gn<span style=color:#719e07>/</span>T<span style=color:#719e07>/</span>ipykernel_12628<span style=color:#719e07>/</span><span style=color:#2aa198>1531564731</span><span style=color:#719e07>.</span>py in <span style=color:#719e07>&lt;</span>module<span style=color:#719e07>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#2aa198>1</span> # the following raises ValueError
</span></span><span style=display:flex><span>          <span style=color:#2aa198>2</span> # pandas DataFrame expects a <span style=color:#2aa198>2</span><span style=color:#719e07>-</span>d input
</span></span><span style=display:flex><span>    <span style=color:#719e07>----&gt;</span> <span style=color:#2aa198>3</span> df_3d <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>DataFrame(arr_3d, columns<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;location&#34;</span>, <span style=color:#2aa198>&#34;product&#34;</span>, <span style=color:#2aa198>&#34;sales&#34;</span>])
</span></span><span style=display:flex><span>    <span style=color:#719e07>.</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>.</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>.</span>
</span></span><span style=display:flex><span>    ValueError: Must pass <span style=color:#2aa198>2</span><span style=color:#719e07>-</span>d input<span style=color:#719e07>.</span> shape<span style=color:#719e07>=</span>(<span style=color:#2aa198>5</span>, <span style=color:#2aa198>3</span>, <span style=color:#2aa198>1</span>)
</span></span></code></pre></div><p>The solution?</p><p><code>MultiIndex</code>.</p><p>Assuming that the ndarray is ordered by location/products, we could prepare a multi-index, flatten our ndarray and let Pandas reshape it according to the provided index.</p><p>Sweet!</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>index <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>MultiIndex<span style=color:#719e07>.</span>from_product(
</span></span><span style=display:flex><span>    [<span style=color:#b58900>range</span>(dim) <span style=color:#719e07>for</span> dim <span style=color:#719e07>in</span> arr_3d<span style=color:#719e07>.</span>shape[:<span style=color:#719e07>-</span><span style=color:#2aa198>1</span>]],
</span></span><span style=display:flex><span>    names<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;location&#34;</span>, <span style=color:#2aa198>&#34;product&#34;</span>],
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df_3d <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>DataFrame(arr_3d<span style=color:#719e07>.</span>flatten(), index<span style=color:#719e07>=</span>index, columns<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;sales&#34;</span>])
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(df_3d)
</span></span></code></pre></div><pre><code>                  sales
location product       
0        0            9
         1            6
         2            2
1        0            1
         1            4
         2            4
2        0            2
         1            5
         2            6
3        0            9
         1            6
         2            5
4        0            1
         1            6
         2            1
</code></pre><p>We just have sales corresponding to each location and product. What if the final <code>sales</code> dimension includes sales for yesterday/today (or for every month, every week, etc.) ?</p><h2 id=3d--dimension--location-x-product-x-sales-multi>3d : dimension = location x product x sales (multi)</h2><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>arr_3d <span style=color:#719e07>=</span> np<span style=color:#719e07>.</span>random<span style=color:#719e07>.</span>randint(
</span></span><span style=display:flex><span>    low<span style=color:#719e07>=</span><span style=color:#2aa198>1</span>,
</span></span><span style=display:flex><span>    high<span style=color:#719e07>=</span><span style=color:#2aa198>10</span>,
</span></span><span style=display:flex><span>    size<span style=color:#719e07>=</span>(<span style=color:#2aa198>5</span>, <span style=color:#2aa198>3</span>, <span style=color:#2aa198>2</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(arr_3d)
</span></span><span style=display:flex><span>index <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>MultiIndex<span style=color:#719e07>.</span>from_product(
</span></span><span style=display:flex><span>    [<span style=color:#b58900>range</span>(dim) <span style=color:#719e07>for</span> dim <span style=color:#719e07>in</span> arr_3d<span style=color:#719e07>.</span>shape],
</span></span><span style=display:flex><span>    names<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;location&#34;</span>, <span style=color:#2aa198>&#34;product&#34;</span>, <span style=color:#2aa198>&#34;sales&#34;</span>],
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><pre><code>[[[1 9]
  [8 6]
  [9 4]]

 [[4 9]
  [3 9]
  [1 8]]

 [[5 2]
  [9 9]
  [1 9]]

 [[4 5]
  [7 4]
  [7 7]]

 [[6 9]
  [4 2]
  [7 1]]]
</code></pre><p>No major changes. Pandas should handle it just like before. Just unstack the sales dimension and rename the columns for readability.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df_3d <span style=color:#719e07>=</span> pd<span style=color:#719e07>.</span>DataFrame(
</span></span><span style=display:flex><span>    arr_3d<span style=color:#719e07>.</span>flatten(),
</span></span><span style=display:flex><span>    index<span style=color:#719e07>=</span>index,
</span></span><span style=display:flex><span>    columns<span style=color:#719e07>=</span>[<span style=color:#2aa198>&#34;sales&#34;</span>],
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>df_3d <span style=color:#719e07>=</span> df_3d<span style=color:#719e07>.</span>unstack(<span style=color:#719e07>-</span><span style=color:#2aa198>1</span>)<span style=color:#719e07>.</span>rename(
</span></span><span style=display:flex><span>    columns<span style=color:#719e07>=</span>{<span style=color:#2aa198>0</span>: <span style=color:#2aa198>&#34;yesterday&#34;</span>, <span style=color:#2aa198>1</span>: <span style=color:#2aa198>&#34;today&#34;</span>},
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#b58900>print</span>(df_3d)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    sales            yesterday today
</span></span><span style=display:flex><span>    location product                
</span></span><span style=display:flex><span>    0        0               1     9
</span></span><span style=display:flex><span>             1               8     6
</span></span><span style=display:flex><span>             2               9     4
</span></span><span style=display:flex><span>    1        0               4     9
</span></span><span style=display:flex><span>             1               3     9
</span></span><span style=display:flex><span>             2               1     8
</span></span><span style=display:flex><span>    2        0               5     2
</span></span><span style=display:flex><span>             1               9     9
</span></span><span style=display:flex><span>             2               1     9
</span></span><span style=display:flex><span>    3        0               4     5
</span></span><span style=display:flex><span>             1               7     4
</span></span><span style=display:flex><span>             2               7     7
</span></span><span style=display:flex><span>    4        0               6     9
</span></span><span style=display:flex><span>             1               4     2
</span></span><span style=display:flex><span>             2               7     1
</span></span></code></pre></div><p>Do you know of other ways to switch between ndarray and DataFrame? Comment below :)</p></article></div></main></div><footer><div><p>&#169; 2022 Saikat Kumar Dey.</p></div></footer></div></body></html>